name: Verificar Secrets

on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 2 * * *' # Executa todos os dias √†s 2h da manh√£ (UTC)
  workflow_dispatch:

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Verificando secrets obrigat√≥rias
        run: |
          MISSING=0

          if [ -z "${{ secrets.SSH_PRIVATE_KEY }}" ]; then
            echo "::error::‚ùå SSH_PRIVATE_KEY est√° vazia ou n√£o foi definida."
            MISSING=1
          else
            echo "‚úÖ SSH_PRIVATE_KEY est√° presente."
          fi

          if [ -z "${{ secrets.SSH_USER }}" ]; then
            echo "::error::‚ùå SSH_USER est√° vazia ou n√£o foi definida."
            MISSING=1
          else
            echo "‚úÖ SSH_USER est√° presente."
          fi

          if [ -z "${{ secrets.SSH_HOST }}" ]; then
            echo "::error::‚ùå SSH_HOST est√° vazia ou n√£o foi definida."
            MISSING=1
          else
            echo "‚úÖ SSH_HOST est√° presente."
          fi

          if [ -z "${{ secrets.DEPLOY_PATH }}" ]; then
            echo "::error::‚ùå DEPLOY_PATH est√° vazia ou n√£o foi definida."
            MISSING=1
          else
            echo "‚úÖ DEPLOY_PATH est√° presente."
          fi

          if [ "$MISSING" -ne 0 ]; then
            echo "::error::‚ùå Existem secrets ausentes. Corrija antes de continuar."
            exit 1
          fi

          echo "üéâ Todas as secrets est√£o presentes!"
